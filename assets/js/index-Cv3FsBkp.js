import{_ as P,a as b,c as w,A as U,b as s,d as r,w as c,g as v,p as y,q as R,e as p,n as C,E as f,u as M,o as E,y as N,F as B,s as $,t as x,B as A,C as k}from"./index-_es1C3IU.js";const H={key:0,class:"game-area"},G={class:"back-button"},I={__name:"NesEmulator",setup(L,{expose:d}){const S=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),u=M(),g=b(!1),T=()=>{const e=document.querySelector("#game");if(e){if(window.EJS_emulator){try{window.EJS_emulator.functions.exit[0](),window.EJS_emulator.audio&&window.EJS_emulator.audio.context&&window.EJS_emulator.audio.context.close(),window.EJS_emulator.keydown&&window.removeEventListener("keydown",window.EJS_emulator.keydown),window.EJS_emulator.keyup&&window.removeEventListener("keyup",window.EJS_emulator.keyup);const a=document.querySelector('script[src*="loader.js"]');a&&a.remove()}catch(a){console.error("清理游戏实例时发生错误:",a)}finally{e.innerHTML="",e.remove()}window.EJS_emulator=null,window.EJS_player=null,window.EJS_gameUrl=null,window.EJS_ready=null,window.EJS_Buttons=null,window.EJS_defaultControls=null,window.EJS_core=null,window.EJS_pathtodata=null,window.EJS_startOnLoaded=null,window.EJS_language=null,window.EJS_gameID=null,window.EJS_gameName=null}g.value=!1,u.push("/nes")}},h={0:{0:{value:"j",value2:"BUTTON_2"},2:{value:"shift",value2:"SELECT"},3:{value:"enter",value2:"START"},4:{value:"w",value2:"DPAD_UP"},5:{value:"s",value2:"DPAD_DOWN"},6:{value:"a",value2:"DPAD_LEFT"},7:{value:"d",value2:"DPAD_RIGHT"},8:{value:"k",value2:"BUTTON_1"},10:{value:"o",value2:"LEFT_TOP_SHOULDER"},11:{value:"i",value2:"RIGHT_TOP_SHOULDER"},13:{value:"l",value2:"RIGHT_BOTTOM_SHOULDER"}},1:{0:{value:"numpad 1",value2:"BUTTON_2"},2:{value:"numpad 0",value2:"SELECT"},3:{value:"decimal point",value2:"START"},4:{value:"up arrow",value2:"DPAD_UP"},5:{value:"down arrow",value2:"DPAD_DOWN"},6:{value:"left arrow",value2:"DPAD_LEFT"},7:{value:"right arrow",value2:"DPAD_RIGHT"},8:{value:"numpad 2",value2:"BUTTON_1"},10:{value:"numpad 6",value2:"LEFT_TOP_SHOULDER"},11:{value:"numpad 5",value2:"RIGHT_TOP_SHOULDER"},13:{value:"numpad 3",value2:"RIGHT_BOTTOM_SHOULDER"}},2:{},3:{}},J=async()=>{try{S&&screen.orientation&&screen.orientation.lock&&await screen.orientation.lock("landscape")}catch(e){console.warn("无法锁定屏幕方向:",e)}},O=async()=>{try{if(S){const e=document.querySelector(".game-area");e&&e.requestFullscreen&&await e.requestFullscreen()}}catch(e){console.warn("无法进入全屏模式:",e)}},D=async(e,a)=>{g.value=!0,S&&(await J(),await O()),C(()=>{const t=document.querySelector("#game");t&&(t.innerHTML="",t.remove());const l=document.createElement("div");l.id="game",l.style.width="100%",l.style.height="100%",document.querySelector(".game-area").appendChild(l);let n,_,m;if(typeof e=="string")m=e,_=m.split("/").pop().split(".")[0],n="arcade";else{const z=e.name.split(".");_=z[0],n=i(z.pop()),m=URL.createObjectURL(e)}window.EJS_player="#game",window.EJS_language="zh-CN",window.EJS_gameID=Math.random().toString(36).substr(2,9),window.EJS_gameName=_,window.EJS_gameUrl=m,window.EJS_core=n,window.EJS_pathtodata="https://cdn.emulatorjs.org/stable/data/",window.EJS_startOnLoaded=!0,window.EJS_DEBUG_XX=!0,window.EJS_disableDatabases=!0,window.EJS_threads=!1,window.EJS_biosUrl="./games/roms/arcade.7z",window.EJS_defaultControls=h;const o=document.createElement("script");o.src="https://cdn.emulatorjs.org/stable/data/loader.js",o.onload=()=>{console.log("EmulatorJS 脚本加载完成"),window.EJS_ready&&window.EJS_ready()},o.onerror=()=>{f.error("EmulatorJS 脚本加载失败")},document.body.appendChild(o)})},i=e=>["fds","nes","unif","unf"].includes(e)?"nes":["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"].includes(e)?"snes":["z64","n64","v64"].includes(e)?"n64":["pce","bin","sgx"].includes(e)?"pce":["ngp","ngc","ngf"].includes(e)?"ngp":["ws","wsc","wsr"].includes(e)?"ws":["col","cv","bin","rom"].includes(e)?"coleco":["d64","g64","x64","t64","tap","prg"].includes(e)?"vice_x64":["gb","gbc"].includes(e)?"gb":["gba","agb"].includes(e)?"gba":["smd","gen","md","bin"].includes(e)?"segaMD":["32x","bin"].includes(e)?"sega32x":["sms","gg","sg"].includes(e)?"segaMS":["a26","bin"].includes(e)?"atari2600":["a78","bin"].includes(e)?"atari7800":["lnx"].includes(e)?"lynx":["vec"].includes(e)?"vectrex":["nds"].includes(e)?"nds":["vb"].includes(e)?"vb":["zip"].includes(e)?"arcade":e;return d({initEmulator:D,isPlaying:g}),(e,a)=>{const t=p("el-button");return g.value?(E(),w("div",H,[s("div",G,[r(t,{onClick:T,icon:y(R),size:"small"},{default:c(()=>a[0]||(a[0]=[v("返回")])),_:1},8,["icon"])])])):U("",!0)}}},F=P(I,[["__scopeId","data-v-710e47d4"]]),q={class:"nes-container"},j={key:0,class:"game-selection"},V={class:"card-header"},W={class:"title"},X={class:"preset-games"},K={class:"game-grid"},Q=["onClick"],Y={class:"game-cover"},Z=["src","alt"],ee={class:"game-name"},ae={class:"card-header"},ne={class:"title"},oe={class:"upload-area"},se={__name:"index",setup(L){b("NES游戏模拟器");const d=b(null),u=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"https://120.25.150.89":"https://zzzb.space",g=b("arcade"),T=[{name:"合金弹头1",url:`${u}/game/yzdownload/mslug.zip`,core:"arcade",cover:"./games/covers/mslug.png"},{name:"合金弹头X",url:`${u}/game/yzdownload/mslugx.zip`,core:"arcade",cover:"./games/covers/mslugx.png"},{name:"合金弹头2",url:`${u}/game/yzdownload/mslug2.zip`,core:"arcade",cover:"./games/covers/mslug2.png"},{name:"合金弹头3",url:`${u}/game/yzdownload/mslug3.zip`,core:"arcade",cover:"./games/covers/mslug3.png"},{name:"合金弹头4",url:`${u}/game/yzdownload/mslug4.zip`,core:"arcade",cover:"./games/covers/mslug4.png"},{name:"合金弹头5",url:`${u}/game/yzdownload/mslug5.zip`,core:"arcade",cover:"./games/covers/mslug5.png"}],h=[{name:"超级玛丽",url:"./games/roms/超级玛丽.nes",core:"nes",cover:"./games/covers/超级玛丽.png"},{name:"热血格斗",url:"./games/roms/热血格斗.nes",core:"nes",cover:"./games/covers/热血格斗.png"},{name:"赤影战士",url:"./games/roms/赤影战士.nes",core:"nes",cover:"./games/covers/赤影战士.png"},{name:"赤色要塞",url:"./games/roms/赤色要塞.nes",core:"nes",cover:"./games/covers/赤色要塞.png"},{name:"超级大富翁",url:"./games/roms/超级大富翁(百万富翁).nes",core:"nes",cover:"./games/covers/超级大富翁(百万富翁).png"},{name:"雪人兄弟",url:"./games/roms/雪人兄弟.nes",core:"nes",cover:"./games/covers/雪人兄弟.png"}],J=N(()=>g.value==="arcade"?T:h),O=async i=>{try{if(i.core==="arcade")d.value.initEmulator(i.url,i.core);else{const a=await(await fetch(i.url)).blob(),t=new File([a],`${i.name}.${i.core}`,{type:"application/octet-stream"});d.value.initEmulator(t)}}catch(e){f.error("加载游戏失败："+e.message)}},D=async i=>{const e=i.raw;if(!e)return;const a=[".nes",".fds",".sfc",".smc",".z64",".n64",".v64",".pce",".ngp",".ngc",".ws",".wsc",".col",".d64",".gb",".gbc",".gba",".smd",".gen",".md",".32x",".sms",".gg",".a26",".a78",".lnx",".vec",".nds",".vb",".zip"],t=e.name.toLowerCase();if(!a.some(l=>t.endsWith(l))){f.error("请上传有效的ROM文件");return}if(!d.value){f.error("模拟器组件未准备就绪，请稍后再试");return}try{if(t.endsWith(".zip")){const l=new FormData;l.append("file",e);const n=await fetch(`${u}/game/upload/`,{method:"POST",body:l});if(console.log("响应状态:",n.status),console.log("响应头:",Object.fromEntries(n.headers.entries())),!n.ok){const o=await n.text();throw console.error("服务器响应错误:",{status:n.status,statusText:n.statusText,errorText:o}),new Error(`上传失败: ${n.status} ${n.statusText}`)}const _=await n.json();console.log("服务器响应数据:",_);const m=`${u}/game/download/${_.filename}`;d.value.initEmulator(m,"arcade")}else d.value.initEmulator(e)}catch(l){f.error("处理ROM文件失败："+l.message)}};return(i,e)=>{var m;const a=p("el-icon"),t=p("el-radio-button"),l=p("el-radio-group"),n=p("el-card"),_=p("el-upload");return E(),w("div",q,[(m=d.value)!=null&&m.isPlaying?U("",!0):(E(),w("div",j,[r(n,{class:"game-card"},{header:c(()=>[s("div",V,[s("span",W,[r(a,null,{default:c(()=>[r(y(A))]),_:1}),e[1]||(e[1]=v(" 预设游戏"))]),r(l,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=o=>g.value=o),size:"small"},{default:c(()=>[r(t,{value:"arcade"},{default:c(()=>e[2]||(e[2]=[v("街机游戏")])),_:1}),r(t,{value:"nes"},{default:c(()=>e[3]||(e[3]=[v("FC游戏")])),_:1})]),_:1},8,["modelValue"])])]),default:c(()=>[s("div",X,[s("div",K,[(E(!0),w(B,null,$(J.value,o=>(E(),w("div",{key:o.name,class:"game-item",onClick:z=>O(o)},[s("div",Y,[s("img",{src:o.cover,alt:o.name},null,8,Z)]),s("div",ee,x(o.name),1)],8,Q))),128))])])]),_:1}),r(n,{class:"upload-card"},{header:c(()=>[s("div",ae,[s("span",ne,[r(a,null,{default:c(()=>[r(y(k))]),_:1}),e[4]||(e[4]=v(" 上传ROM文件"))])])]),default:c(()=>[s("div",oe,[r(_,{class:"upload-container",accept:".nes,.fds,.sfc,.smc,.z64,.n64,.v64,.pce,.ngp,.ngc,.ws,.wsc,.col,.d64,.gb,.gbc,.gba,.smd,.gen,.md,.32x,.sms,.gg,.a26,.a78,.lnx,.vec,.nds,.vb,.zip","auto-upload":!1,"show-file-list":!1,onChange:D,drag:""},{tip:c(()=>e[5]||(e[5]=[s("div",{class:"el-upload__tip"}," 支持的格式：.nes, .sfc, .smc 等 ",-1)])),default:c(()=>[r(a,{class:"el-icon--upload"},{default:c(()=>[r(y(k))]),_:1}),e[6]||(e[6]=s("div",{class:"el-upload__text"},[v(" 将ROM文件拖到此处，或 "),s("em",null,"点击上传")],-1))]),_:1})])]),_:1})])),r(F,{ref_key:"nesEmulator",ref:d},null,512)])}}},te=P(se,[["__scopeId","data-v-c9ffd299"]]);export{te as default};
