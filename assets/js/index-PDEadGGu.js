import{_ as P,a as D,c as E,A as L,b as s,d as t,w as c,g as S,p as b,q as R,e as y,n as M,E as w,u as C,o as h,F as N,s as B,t as $,B as x,C as z}from"./index-DeZBs9YJ.js";const A={key:0,class:"game-area"},H={class:"back-button"},I={__name:"NesEmulator",setup(U,{expose:i}){const v=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),l=C(),g=D(!1),T=()=>{const e=document.querySelector("#game");if(e){if(window.EJS_emulator){try{window.EJS_emulator.functions.exit[0](),window.EJS_emulator.audio&&window.EJS_emulator.audio.context&&window.EJS_emulator.audio.context.close(),window.EJS_emulator.keydown&&window.removeEventListener("keydown",window.EJS_emulator.keydown),window.EJS_emulator.keyup&&window.removeEventListener("keyup",window.EJS_emulator.keyup);const a=document.querySelector('script[src*="loader.js"]');a&&a.remove()}catch(a){console.error("清理游戏实例时发生错误:",a)}finally{e.innerHTML="",e.remove()}window.EJS_emulator=null,window.EJS_player=null,window.EJS_gameUrl=null,window.EJS_ready=null,window.EJS_Buttons=null,window.EJS_defaultControls=null,window.EJS_core=null,window.EJS_pathtodata=null,window.EJS_startOnLoaded=null,window.EJS_language=null,window.EJS_gameID=null,window.EJS_gameName=null}g.value=!1,l.push("/nes")}},J={0:{0:{value:"j",value2:"BUTTON_2"},2:{value:"shift",value2:"SELECT"},3:{value:"enter",value2:"START"},4:{value:"w",value2:"DPAD_UP"},5:{value:"s",value2:"DPAD_DOWN"},6:{value:"a",value2:"DPAD_LEFT"},7:{value:"d",value2:"DPAD_RIGHT"},8:{value:"k",value2:"BUTTON_1"},10:{value:"o",value2:"LEFT_TOP_SHOULDER"},11:{value:"i",value2:"RIGHT_TOP_SHOULDER"},13:{value:"l",value2:"RIGHT_BOTTOM_SHOULDER"}},1:{0:{value:"numpad 1",value2:"BUTTON_2"},2:{value:"numpad 0",value2:"SELECT"},3:{value:"decimal point",value2:"START"},4:{value:"up arrow",value2:"DPAD_UP"},5:{value:"down arrow",value2:"DPAD_DOWN"},6:{value:"left arrow",value2:"DPAD_LEFT"},7:{value:"right arrow",value2:"DPAD_RIGHT"},8:{value:"numpad 2",value2:"BUTTON_1"},10:{value:"numpad 6",value2:"LEFT_TOP_SHOULDER"},11:{value:"numpad 5",value2:"RIGHT_TOP_SHOULDER"},13:{value:"numpad 3",value2:"RIGHT_BOTTOM_SHOULDER"}},2:{},3:{}},r=async()=>{try{v&&screen.orientation&&screen.orientation.lock&&await screen.orientation.lock("landscape")}catch(e){console.warn("无法锁定屏幕方向:",e)}},n=async()=>{try{if(v){const e=document.querySelector(".game-area");e&&e.requestFullscreen&&await e.requestFullscreen()}}catch(e){console.warn("无法进入全屏模式:",e)}},u=async(e,a)=>{g.value=!0,v&&(await r(),await n()),M(()=>{const o=document.querySelector("#game");o&&(o.innerHTML="",o.remove());const m=document.createElement("div");m.id="game",m.style.width="100%",m.style.height="100%",document.querySelector(".game-area").appendChild(m);let _,O,p;if(typeof e=="string")p=e,O=p.split("/").pop().split(".")[0],_="arcade";else{const k=e.name.split(".");O=k[0],_=d(k.pop()),p=URL.createObjectURL(e)}window.EJS_player="#game",window.EJS_language="zh-CN",window.EJS_gameID=Math.random().toString(36).substr(2,9),window.EJS_gameName=O,window.EJS_gameUrl=p,window.EJS_core=_,window.EJS_pathtodata="https://cdn.emulatorjs.org/stable/data/",window.EJS_startOnLoaded=!0,window.EJS_DEBUG_XX=!0,window.EJS_disableDatabases=!0,window.EJS_threads=!1,window.EJS_biosUrl="./games/roms/arcade.7z",window.EJS_defaultControls=J;const f=document.createElement("script");f.src="https://cdn.emulatorjs.org/stable/data/loader.js",f.onload=()=>{console.log("EmulatorJS 脚本加载完成"),window.EJS_ready&&window.EJS_ready()},f.onerror=()=>{w.error("EmulatorJS 脚本加载失败")},document.body.appendChild(f)})},d=e=>["fds","nes","unif","unf"].includes(e)?"nes":["smc","fig","sfc","gd3","gd7","dx2","bsx","swc"].includes(e)?"snes":["z64","n64","v64"].includes(e)?"n64":["pce","bin","sgx"].includes(e)?"pce":["ngp","ngc","ngf"].includes(e)?"ngp":["ws","wsc","wsr"].includes(e)?"ws":["col","cv","bin","rom"].includes(e)?"coleco":["d64","g64","x64","t64","tap","prg"].includes(e)?"vice_x64":["gb","gbc"].includes(e)?"gb":["gba","agb"].includes(e)?"gba":["smd","gen","md","bin"].includes(e)?"segaMD":["32x","bin"].includes(e)?"sega32x":["sms","gg","sg"].includes(e)?"segaMS":["a26","bin"].includes(e)?"atari2600":["a78","bin"].includes(e)?"atari7800":["lnx"].includes(e)?"lynx":["vec"].includes(e)?"vectrex":["nds"].includes(e)?"nds":["vb"].includes(e)?"vb":["zip"].includes(e)?"arcade":e;return i({initEmulator:u,isPlaying:g}),(e,a)=>{const o=y("el-button");return g.value?(h(),E("div",A,[s("div",H,[t(o,{onClick:T,icon:b(R),size:"small"},{default:c(()=>a[0]||(a[0]=[S("返回")])),_:1},8,["icon"])])])):L("",!0)}}},G=P(I,[["__scopeId","data-v-710e47d4"]]),q={class:"nes-container"},F={key:0,class:"game-selection"},j={class:"card-header"},V={class:"title"},W={class:"preset-games"},X={class:"game-grid"},K=["onClick"],Q={class:"game-cover"},Y=["src","alt"],Z={class:"game-name"},ee={class:"card-header"},ae={class:"title"},ne={class:"upload-area"},se={__name:"index",setup(U){D("NES游戏模拟器");const i=D(null),l=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"https://120.25.150.89":"https://zzzb.space",g=[{name:"合金弹头1",url:`${l}/game/yzdownload/mslug.zip`,core:"arcade",cover:"./games/covers/mslug.png"},{name:"合金弹头X",url:`${l}/game/yzdownload/mslugx.zip`,core:"arcade",cover:"./games/covers/mslugx.png"},{name:"合金弹头2",url:`${l}/game/yzdownload/mslug2.zip`,core:"arcade",cover:"./games/covers/mslug2.png"},{name:"合金弹头3",url:`${l}/game/yzdownload/mslug3.zip`,core:"arcade",cover:"./games/covers/mslug3.png"},{name:"合金弹头4",url:`${l}/game/yzdownload/mslug4.zip`,core:"arcade",cover:"./games/covers/mslug4.png"},{name:"合金弹头5",url:`${l}/game/yzdownload/mslug5.zip`,core:"arcade",cover:"./games/covers/mslug5.png"},{name:"超级玛丽",url:"./games/roms/超级玛丽.nes",core:"nes",cover:"./games/covers/超级玛丽.png"},{name:"热血格斗",url:"./games/roms/热血格斗.nes",core:"nes",cover:"./games/covers/热血格斗.png"},{name:"赤影战士",url:"./games/roms/赤影战士.nes",core:"nes",cover:"./games/covers/赤影战士.png"},{name:"赤色要塞",url:"./games/roms/赤色要塞.nes",core:"nes",cover:"./games/covers/赤色要塞.png"},{name:"超级大富翁",url:"./games/roms/超级大富翁(百万富翁).nes",core:"nes",cover:"./games/covers/超级大富翁(百万富翁).png"},{name:"雪人兄弟",url:"./games/roms/雪人兄弟.nes",core:"nes",cover:"./games/covers/雪人兄弟.png"}],T=async r=>{try{if(r.core==="arcade")i.value.initEmulator(r.url,r.core);else{const u=await(await fetch(r.url)).blob(),d=new File([u],`${r.name}.${r.core}`,{type:"application/octet-stream"});i.value.initEmulator(d)}}catch(n){w.error("加载游戏失败："+n.message)}},J=async r=>{const n=r.raw;if(!n)return;const u=[".nes",".fds",".sfc",".smc",".z64",".n64",".v64",".pce",".ngp",".ngc",".ws",".wsc",".col",".d64",".gb",".gbc",".gba",".smd",".gen",".md",".32x",".sms",".gg",".a26",".a78",".lnx",".vec",".nds",".vb",".zip"],d=n.name.toLowerCase();if(!u.some(e=>d.endsWith(e))){w.error("请上传有效的ROM文件");return}if(!i.value){w.error("模拟器组件未准备就绪，请稍后再试");return}try{if(d.endsWith(".zip")){const e=new FormData;e.append("file",n);const a=await fetch(`${l}/game/upload/`,{method:"POST",body:e});if(console.log("响应状态:",a.status),console.log("响应头:",Object.fromEntries(a.headers.entries())),!a.ok){const _=await a.text();throw console.error("服务器响应错误:",{status:a.status,statusText:a.statusText,errorText:_}),new Error(`上传失败: ${a.status} ${a.statusText}`)}const o=await a.json();console.log("服务器响应数据:",o);const m=`${l}/game/download/${o.filename}`;i.value.initEmulator(m,"arcade")}else i.value.initEmulator(n)}catch(e){w.error("处理ROM文件失败："+e.message)}};return(r,n)=>{var a;const u=y("el-icon"),d=y("el-card"),e=y("el-upload");return h(),E("div",q,[(a=i.value)!=null&&a.isPlaying?L("",!0):(h(),E("div",F,[t(d,{class:"game-card"},{header:c(()=>[s("div",j,[s("span",V,[t(u,null,{default:c(()=>[t(b(x))]),_:1}),n[0]||(n[0]=S(" 预设游戏"))])])]),default:c(()=>[s("div",W,[s("div",X,[(h(),E(N,null,B(g,o=>s("div",{key:o.name,class:"game-item",onClick:m=>T(o)},[s("div",Q,[s("img",{src:o.cover,alt:o.name},null,8,Y)]),s("div",Z,$(o.name),1)],8,K)),64))])])]),_:1}),t(d,{class:"upload-card"},{header:c(()=>[s("div",ee,[s("span",ae,[t(u,null,{default:c(()=>[t(b(z))]),_:1}),n[1]||(n[1]=S(" 上传ROM文件"))])])]),default:c(()=>[s("div",ne,[t(e,{class:"upload-container",accept:".nes,.fds,.sfc,.smc,.z64,.n64,.v64,.pce,.ngp,.ngc,.ws,.wsc,.col,.d64,.gb,.gbc,.gba,.smd,.gen,.md,.32x,.sms,.gg,.a26,.a78,.lnx,.vec,.nds,.vb,.zip","auto-upload":!1,"show-file-list":!1,onChange:J,drag:""},{tip:c(()=>n[2]||(n[2]=[s("div",{class:"el-upload__tip"}," 支持的格式：.nes, .sfc, .smc 等 ",-1)])),default:c(()=>[t(u,{class:"el-icon--upload"},{default:c(()=>[t(b(z))]),_:1}),n[3]||(n[3]=s("div",{class:"el-upload__text"},[S(" 将ROM文件拖到此处，或 "),s("em",null,"点击上传")],-1))]),_:1})])]),_:1})])),t(G,{ref_key:"nesEmulator",ref:i},null,512)])}}},re=P(se,[["__scopeId","data-v-968d4e98"]]);export{re as default};
